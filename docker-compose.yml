version: '3.8'
services:
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    image: clph-frontend:local
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
    volumes:
      # use named Docker volumes to persist uploaded files across restarts
      - pending-resources:/app/frontend/public/pending-resources:rw
      - learning-resources:/app/frontend/public/learning-resources:rw
      - class-cards:/app/frontend/public/class-cards:rw
      # If you prefer to mount a host path instead, replace the lines above with:
      # - /var/www/frontend/public/pending-resources:/app/frontend/public/pending-resources:rw
      # - /var/www/frontend/public/learning-resources:/app/frontend/public/learning-resources:rw
    restart: unless-stopped

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    image: clph-backend:local
    ports:
      - "4000:4000"
    environment:
      - PORT=4000
      - ENABLE_DEBUG_ENDPOINTS=true
      - PENDING_RESOURCES_DIR=/app/frontend/public/pending-resources
      - PENDING_RESOURCES_URL=https://cictpeerlearninghub.com/pending-resources
      - LEARNING_RESOURCES_DIR=/app/frontend/public/learning-resources
      - LEARNING_RESOURCES_URL=https://cictpeerlearninghub.com/learning-resources
      - CLASS_CARDS_DIR=/app/frontend/public/class-cards
      - CLASS_CARDS__URL=https://cictpeerlearninghub.com/class-cards
      - FRONTEND_URL=http://localhost:3000
    volumes:
      - pending-resources:/app/frontend/public/pending-resources:rw
      - learning-resources:/app/frontend/public/learning-resources:rw
      - class-cards:/app/frontend/public/class-cards:rw
      # Or, to use host paths instead, uncomment and set the host directories:
      # - /var/www/frontend/public/pending-resources:/app/frontend/public/pending-resources:rw
      # - /var/www/frontend/public/learning-resources:/app/frontend/public/learning-resources:rw
    depends_on:
      - frontend
    restart: unless-stopped

volumes:
  pending-resources:
    driver: local
  learning-resources:
    driver: local
  class-cards:
    driver: local
